<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bark 推送</title>
    <style>
        /* 基础样式 */
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            scroll-behavior: smooth;
            background-color: #f5f5f7;
            color: #1d1d1f;
            overflow-x: hidden;
        }
        /* 渐变背景 */
        .gradient-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background: linear-gradient(120deg, #f5f5f7, #e0e0e5, #f5f5f7);
            background-size: 200% 200%;
            animation: gradientMove 15s ease infinite;
        }
        /* 深色模式样式 */
        @media (prefers-color-scheme: dark) {
            body {
                background-color: #121212;
                color: #f5f5f7;
            }
            .card {
                background-color: #1d1d1f;
                color: #e0e0e0;
            }
            .title-container {
                background-color: #1d1d1f;
                color: #e0e0e0;
            }
            .subtitle {
                color: #a0a0a0;
            }
            .back-to-top {
                background-color: rgba(45, 45, 45, 0.8);
                color: #f5f5f7;
            }
            .back-to-top:hover {
                background-color: rgba(60, 60, 60, 0.9);
            }
            /* 深色模式进度条 */
            #progress {
                background-color: rgba(255, 255, 255, 0.3);
                backdrop-filter: blur(2px);
            }
            /* 深色模式导航栏 */
            .nav {
                background-color: rgba(18, 18, 18, 0.9);
            }
            .nav a {
                color: #f5f5f7;
            }
            .mobile-menu {
                background-color: #121212;
            }
            .mobile-menu a {
                color: #f5f5f7;
            }
            .mobile-menu a:hover {
                color: #2997ff;
            }
            /* 深色模式渐变背景 */
            .gradient-bg {
                background: linear-gradient(120deg, #121212, #1d1d1f, #121212);
                background-size: 200% 200%;
            }
        }
        /* 深色模式类样式 */
        body.dark-mode {
            background-color: #121212;
            color: #f5f5f7;
        }
        body.dark-mode .card {
            background-color: #1d1d1f;
            color: #e0e0e0;
        }
        body.dark-mode .title-container {
            background-color: #1d1d1f;
            color: #e0e0e0;
        }
        body.dark-mode .subtitle {
            color: #a0a0a0;
        }
        body.dark-mode .back-to-top {
            background-color: rgba(45, 45, 45, 0.8);
            color: #f5f5f7;
        }
        body.dark-mode .back-to-top:hover {
            background-color: rgba(60, 60, 60, 0.9);
        }
        body.dark-mode #progress {
            background-color: rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(2px);
        }
        body.dark-mode .nav {
            background-color: rgba(18, 18, 18, 0.9);
        }
        body.dark-mode .nav a {
            color: #f5f5f7;
        }
        body.dark-mode .mobile-menu {
            background-color: #121212;
        }
        body.dark-mode .mobile-menu a {
            color: #f5f5f7;
        }
        body.dark-mode .mobile-menu a:hover {
            color: #2997ff;
        }
        body.dark-mode .gradient-bg {
            background: linear-gradient(120deg, #121212, #1d1d1f, #121212);
            background-size: 200% 200%;
        }
        :root {
            --ease-in-out-expo: cubic-bezier(0.19, 1, 0.22, 1);
            --apple-blue: #0071e3;
            --apple-light-blue: #2997ff;
        }
        /* 进度条 */
        #progress-bar {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background-color: transparent;
            z-index: 1000;
        }
        #progress {
            height: 100%;
            width: 0;
            background-color: rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(2px);
            transition: width 0.1s ease;
        }
        /* 导航栏 - 模仿Apple风格 */
        .nav {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            background-color: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(20px);
            z-index: 999;
            border-bottom: 1px solid rgba(0, 0, 0, 0.08);
        }
        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
        }
        .nav-logo {
            padding: 10px 0;
            font-size: 20px;
            font-weight: bold;
        }
        .nav-links {
            display: flex;
            list-style: none;
            margin: 0;
            padding: 0;
        }
        .nav-links li {
            margin: 0 20px;
        }
        .nav-links a {
            color: #1d1d1f;
            text-decoration: none;
            font-size: 14px;
            padding: 16px 0;
            display: block;
            transition: color 0.2s;
        }
        .nav-links a:hover {
            color: var(--apple-blue);
        }
        /* 移动端菜单按钮 */
        .menu-toggle {
            display: none;
            cursor: pointer;
            padding: 16px 0;
        }
        .menu-toggle .bar {
            width: 20px;
            height: 1px;
            background-color: #1d1d1f;
            margin: 5px 0;
            transition: all 0.3s ease;
        }
        /* 移动端菜单 */
        .mobile-menu {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.98);
            z-index: 998;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.4s var(--ease-in-out-expo), visibility 0.4s var(--ease-in-out-expo);
            overflow-y: auto;
        }
        .mobile-menu.visible {
            opacity: 1;
            visibility: visible;
        }
        .mobile-menu-content {
            padding: 60px 20px 20px;
            max-width: 800px;
            margin: 0 auto;
        }
        .mobile-menu ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        .mobile-menu li {
            opacity: 0;
            transform: translateY(10px);
            transition: opacity 0.3s var(--ease-in-out-expo), transform 0.3s var(--ease-in-out-expo);
            transition-delay: 0s; /* 初始延迟为0，通过JS动态设置 */
        }
        /* 菜单展开时列表项的可见状态 */
        .mobile-menu.visible li {
            opacity: 1;
            transform: translateY(0);
        }
        .mobile-menu a {
            color: #1d1d1f;
            text-decoration: none;
            font-size: clamp(1.5rem, 3vw, 2rem); /* 增大字号 */
            padding: 24px 0; /* 增加上下间距 */
            display: block;
            font-weight: 300; /* 减轻字体粗细，更接近Apple风格 */
            transition: color 0.2s var(--ease-in-out-expo);
            position: relative;
        }
        .mobile-menu a:hover {
            color: var(--apple-blue);
        }
        /* 内容容器 */
        .content {
            padding-top: 60px; /* 为固定导航栏留出空间 */
            position: relative;
            z-index: 1;
            padding-bottom: 20px; /* 增加底部内边距，避免内容贴底 */
        }
        .title-container {
            height: 40vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 2rem;
            background-color: rgba(251, 251, 253, 0.8);
            margin-bottom: 1rem;
            opacity: 0;
            transform: translateY(30px);
            transition: opacity 1s var(--ease-in-out-expo), transform 1s var(--ease-in-out-expo);
            backdrop-filter: blur(10px);
        }
        .title-container.visible {
            opacity: 1;
            transform: translateY(0);
        }
        .title {
            font-size: clamp(2rem, 5vw, 3.5rem);
            font-weight: bold;
            margin-bottom: 0.5rem;
        }
        .subtitle {
            font-size: clamp(1rem, 2vw, 1.25rem);
            color: #6e6e73;
            max-width: 800px;
        }
        .content-container {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1rem;
            padding: 1rem;
        }
        .card {
            border-radius: 18px;
            padding: 2rem;
            background-color: rgba(255, 255, 255, 0.8);
            margin-bottom: 1rem;
            overflow: hidden;
            position: relative;
            transition: 
                transform 0.3s var(--ease-in-out-expo), 
                box-shadow 0.3s var(--ease-in-out-expo), 
                opacity 1s var(--ease-in-out-expo), 
                transform 1s var(--ease-in-out-expo);
            opacity: 0; /* 初始透明度为0 */
            transform: translateY(30px); /* 初始位置偏移 */
            backdrop-filter: blur(10px);
        }
        .card.visible {
            opacity: 1; /* 可见时透明度为1 */
            transform: translateY(0); /* 可见时位置恢复正常 */
        }
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 20px rgba(0, 0, 0, 0.1);
        }
        .card h2 {
            font-size: clamp(1.5rem, 3vw, 2rem);
            margin-top: 0;
            margin-bottom: 1rem;
        }
        .card p,
        .card ul,
        .card ol,
        .card form {
            font-size: clamp(1rem, 1.5vw, 1.1rem);
            line-height: 1.6;
        }
        .card form div {
            margin-bottom: 1rem;
        }
        .card form label {
            display: block;
            margin-bottom: 0.25rem;
            font-weight: 500;
        }
        .card form input[type="text"],
        .card form input[type="url"],
        .card form input[type="number"],
        .card form select,
        .card form textarea {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #ccc;
            border-radius: 8px;
            font-size: 1rem;
            box-sizing: border-box;
        }
        .card form textarea {
            min-height: 80px;
            resize: vertical;
        }
        .card form button {
            background-color: var(--apple-blue);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            transition: background-color 0.2s;
        }
        .card form button:hover {
            background-color: var(--apple-light-blue);
        }
        /* 设备选择器样式 */
        .device-selector {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-right: 20px;
        }
        .device-selector select {
            padding: 6px 12px;
            border: 1px solid #ccc;
            border-radius: 6px;
            font-size: 14px;
            background-color: white;
            color: #1d1d1f;
            cursor: pointer;
            outline: none;
        }
        .device-selector select:hover {
            border-color: var(--apple-blue);
        }
        body.dark-mode .device-selector select {
            background-color: #2c2c2e;
            color: #f5f5f7;
            border-color: #48484a;
        }
        /* 移动端菜单设备选择器 */
        .mobile-menu .device-selector {
            margin: 20px 0;
            padding: 15px 0;
            border-bottom: 1px solid #e0e0e0;
        }
        body.dark-mode .mobile-menu .device-selector {
            border-bottom-color: #48484a;
        }
        .mobile-menu .device-selector label {
            font-size: 1.2rem;
            font-weight: 300;
        }
        .mobile-menu .device-selector select {
            flex: 1;
            padding: 10px;
            font-size: 1rem;
        }
        /* 响应式设计 */
        @media (max-width: 768px) {
            .device-selector-desktop {
                display: none;
            }
            .nav-container {
                flex-wrap: wrap;
            }
        }
        @media (min-width: 769px) {
            .device-selector-mobile {
                display: none;
            }
        }
        /* 历史消息左滑删除样式 */
        .history-item {
            padding: 0.5rem 0;
            border-bottom: 1px solid #ccc;
            position: relative;
            overflow: hidden;
            transition: transform 0.3s ease;
        }
        .history-item:last-of-type {
            border-bottom: none;
        }
        .history-item .time {
            font-size: 0.85rem;
            color: #888;
        }
        .history-item .details {
            margin-top: 0.25rem;
            font-size: 0.9rem;
        }
        .history-item .delete-btn {
            position: absolute;
            right: 0;
            top: 0;
            bottom: 0;
            width: 80px;
            background-color: #ff3b30;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            transform: translateX(100%);
            transition: transform 0.3s ease;
            border: none;
            cursor: pointer;
            font-size: 14px;
        }
        .history-item.swiped .delete-btn {
            transform: translateX(0);
        }
        .history-item.swiped {
            transform: translateX(-80px);
        }
        /* 重置按钮样式 */
        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 1rem;
        }
        .btn-reset {
            background-color: #8e8e93 !important;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            transition: background-color 0.2s;
            flex: 0 0 auto;
        }
        .btn-reset:hover {
            background-color: #636366 !important;
        }
        .btn-submit {
            flex: 1;
        }
        /* 移动端菜单操作项样式 */
        .mobile-menu-actions {
            border-top: 1px solid #e0e0e0;
            margin-top: 20px;
            padding-top: 20px;
        }
        body.dark-mode .mobile-menu-actions {
            border-top-color: #48484a;
        }
        .mobile-menu-actions a {
            color: #ff3b30 !important;
            font-size: 1.2rem;
            padding: 15px 0;
            display: block;
        }
        .status-message {
            margin-top: 1rem;
            padding: 0.75rem;
            border-radius: 8px;
        }
        .status-success {
            background-color: #d4edda;
            color: #155724;
        }
        .status-error {
            background-color: #f8d7da;
            color: #721c24;
        }
        .back-to-top {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background-color: rgba(255, 255, 255, 0.8);
            color: #333;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            cursor: pointer;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s var(--ease-in-out-expo), visibility 0.3s var(--ease-in-out-expo);
            z-index: 100;
            backdrop-filter: blur(10px);
        }
        .back-to-top.visible {
            opacity: 1;
            visibility: visible;
        }
        .back-to-top:hover {
            background-color: rgba(255, 255, 255, 0.95);
        }
        .back-to-top svg {
            width: 20px;
            height: 20px;
        }
        /* 渐变动画 */
        @keyframes gradientMove {
            0% {
                background-position: 0% 50%;
            }
            50% {
                background-position: 100% 50%;
            }
            100% {
                background-position: 0% 50%;
            }
        }
        /* 响应式设计 */
        @media (max-width: 768px) {
            .nav-links {
                display: none;
            }
            .menu-toggle {
                display: block;
            }
            /* 汉堡菜单变叉动画 */
            .menu-toggle.active .bar:nth-child(1) {
                transform: translateY(6px) rotate(45deg);
            }
            .menu-toggle.active .bar:nth-child(2) {
                opacity: 0;
            }
            .menu-toggle.active .bar:nth-child(3) {
                transform: translateY(-6px) rotate(-45deg);
            }
        }
        @media (min-width: 768px) {
            .content-container {
                grid-template-columns: repeat(2, 1fr);
            }
            .title-container {
                height: 50vh;
            }
        }
        @media (min-width: 1200px) {
            .content-container {
                grid-template-columns: repeat(2, 1fr);
                max-width: 1600px;
                margin: 0 auto;
            }
        }
    </style>
</head>
<body>
    <!-- 渐变背景 -->
    <div class="gradient-bg"></div>
    <!-- 进度条 -->
    <div id="progress-bar">
        <div id="progress"></div>
    </div>
    <!-- 导航栏 -->
    <nav class="nav">
        <div class="nav-container">
            <div class="nav-logo">Bark 控制台</div>
            <!-- 桌面端设备选择器 -->
            <div class="device-selector device-selector-desktop">
                <select id="deviceSelect">
                    <option value="iphone">iPhone 12 Pro Max</option>
                    <option value="ipad">iPad Mini 5</option>
                </select>
            </div>
            <!-- 桌面导航 - 可选，此处可添加链接 -->
            <ul class="nav-links">
                <!-- <li><a href="#send">发送</a></li> -->
                <!-- <li><a href="#history">历史</a></li> -->
            </ul>
            <!-- 移动端菜单按钮 -->
            <div class="menu-toggle" id="menuToggle">
                <div class="bar"></div>
                <div class="bar"></div>
                <div class="bar"></div>
            </div>
        </div>
    </nav>
    <!-- 移动端菜单 -->
    <div class="mobile-menu" id="mobileMenu">
        <div class="mobile-menu-content">
            <!-- 移动端设备选择器 -->
            <div class="device-selector device-selector-mobile">
                <label>选择设备:</label>
                <select id="deviceSelectMobile">
                    <option value="iphone">iPhone 12 Pro Max</option>
                    <option value="ipad">iPad Mini 5</option>
                </select>
            </div>
            <ul>
                <!-- <li><a href="#send">发送</a></li> -->
                <!-- <li><a href="#history">历史</a></li> -->
            </ul>
            <!-- 移动端操作按钮 -->
            <div class="mobile-menu-actions">
                <a href="javascript:void(0)" id="deleteCookieBtn">删除所有 Cookie</a>
            </div>
        </div>
    </div>
    <!-- 内容 -->
    <div class="content">
        <div class="title-container">
            <div class="title">Bark 推送</div>
            <div class="subtitle">向您的 iPhone 发送自定义通知</div>
        </div>
        <div class="content-container">
            <!-- 发送通知卡片 -->
            <div class="card">
                <h2>发送通知</h2>
                <form id="barkForm">
                    <div>
                        <label for="title">标题 (title):</label>
                        <input type="text" id="title" name="title" placeholder="通知标题">
                    </div>
                    <div>
                        <label for="body">内容 (body):</label>
                        <textarea id="body" name="body" placeholder="通知内容"></textarea>
                    </div>
                    <div>
                        <label for="level">通知类型 (level):</label>
                        <select id="level" name="level">
                            <option value="active">active (活跃)</option>
                            <option value="passive">passive (被动)</option>
                            <option value="timeSensitive">timeSensitive (时效性)</option>
                            <option value="critical">critical (重要警告)</option>
                        </select>
                    </div>
                    <div>
                        <label for="sound">铃声 (sound):</label>
                        <input type="text" id="sound" name="sound" placeholder="铃声名称，如: alarm">
                    </div>
                    <div>
                        <label for="volume">音量 (volume, 仅critical有效):</label>
                        <input type="number" id="volume" name="volume" min="0" max="10" value="5" placeholder="0-10">
                    </div>
                    <div>
                        <label for="icon">图标 (icon URL):</label>
                        <input type="url" id="icon" name="icon" placeholder="图标URL">
                    </div>
                    <div>
                        <label for="group">分组 (group):</label>
                        <input type="text" id="group" name="group" placeholder="消息分组名">
                    </div>
                    <div>
                        <label for="url">点击跳转URL (url):</label>
                        <input type="url" id="url" name="url" placeholder="点击通知跳转的链接">
                    </div>
                    <div>
                        <label for="action">点击行为 (action):</label>
                        <select id="action" name="action">
                            <option value="">默认 (打开APP)</option>
                            <option value="none">none (无操作)</option>
                        </select>
                    </div>
                     <div>
                        <label for="call">持续响铃 (call):</label>
                        <select id="call" name="call">
                            <option value="">否</option>
                            <option value="1">是 (传入1)</option>
                        </select>
                    </div>
                    <div>
                        <label for="isArchive">是否保存 (isArchive):</label>
                        <select id="isArchive" name="isArchive">
                            <option value="">按APP设置</option>
                            <option value="1">保存 (传入1)</option>
                            <option value="0">不保存 (传入0)</option>
                        </select>
                    </div>
                    <div>
                        <label for="id">通知ID (id, 用于更新/删除):</label>
                        <input type="text" id="id" name="id" placeholder="用于更新或删除通知的ID">
                    </div>
                    <div>
                        <label for="delete">删除通知 (delete, 需配合ID):</label>
                        <select id="delete" name="delete">
                            <option value="">否</option>
                            <option value="1">是 (传入1)</option>
                        </select>
                    </div>
                    <div class="button-group">
                        <button type="button" class="btn-reset" id="resetBtn">重置</button>
                        <button type="submit" class="btn-submit">发送通知</button>
                    </div>
                </form>
                <div id="statusMessage" class="status-message" style="display: none;"></div>
            </div>
            <!-- 历史记录卡片 -->
            <div class="card">
                <h2>发送历史</h2>
                <div id="historyList">
                    <!-- 历史记录将通过JavaScript动态插入 -->
                </div>
            </div>
        </div>
    </div>
    <!-- 返回顶部按钮 -->
    <div class="back-to-top" id="backToTop">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M7.41,15.41L12,10.83L16.59,15.41L18,14L12,8L6,14L7.41,15.41Z" />
        </svg>
    </div>
    <script>
        // 设备配置
        const devices = {
            iphone: {
                name: 'iPhone 12 Pro Max',
                key: 'hUPQUTQChCktjKGDThD7SR'
            },
            ipad: {
                name: 'iPad Mini 5',
                key: 'S5v9STmq7kB8uQq5tPs9Qm'
            }
        };
        const deviceCookieName = 'barkDevice';
        const formDataCookieName = 'barkFormData';
        const historyCookieName = 'barkHistory';
        const maxHistoryItems = 50; // 最多保存50条历史记录
        // 获取当前选中的设备
        function getCurrentDevice() {
            const savedDevice = getCookie(deviceCookieName);
            return savedDevice && devices[savedDevice] ? savedDevice : 'iphone';
        }
        // 获取当前API URL
        function getCurrentApiUrl() {
            const device = getCurrentDevice();
            return `https://api.day.app/${devices[device].key}`;
        }
        // 应用主题
        function applyTheme(isDark) {
            if (isDark) {
                document.body.classList.add('dark-mode');
            } else {
                document.body.classList.remove('dark-mode');
            }
        }
        // 检测当前深色模式状态
        function isDarkMode() {
            return window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
        }
        // 初始化主题
        applyTheme(isDarkMode());
        // 监听深色模式变化
        const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');
        if (mediaQuery.addEventListener) {
            mediaQuery.addEventListener('change', (e) => {
                applyTheme(e.matches);
            });
        } else if (mediaQuery.addListener) {
            // 兼容旧版 Safari (iOS < 14)
            mediaQuery.addListener((e) => {
                applyTheme(e.matches);
            });
        }
        // 导航菜单切换及动画
        const menuToggle = document.getElementById('menuToggle');
        const mobileMenu = document.getElementById('mobileMenu');
        const mobileMenuItems = mobileMenu.querySelectorAll('li');
        // 设置列表项动画延迟
        function setupMenuAnimations() {
            mobileMenuItems.forEach((item, index) => {
                // 使用非线性延迟，使动画更有节奏感
                const delay = Math.pow(index, 1.2) * 60;
                item.style.transitionDelay = `${delay}ms`;
            });
        }
        // 初始化菜单动画设置
        setupMenuAnimations();
        menuToggle.addEventListener('click', () => {
            menuToggle.classList.toggle('active');
            mobileMenu.classList.toggle('visible');
            // 阻止/恢复页面滚动
            if (mobileMenu.classList.contains('visible')) {
                document.body.style.overflow = 'hidden';
            } else {
                document.body.style.overflow = '';
            }
        });
        // 点击移动菜单中的链接时关闭菜单
        const mobileLinks = mobileMenu.querySelectorAll('a');
        mobileLinks.forEach(link => {
            link.addEventListener('click', () => {
                menuToggle.classList.remove('active');
                mobileMenu.classList.remove('visible');
                document.body.style.overflow = '';
            });
        });
        // 获取Cookie
        function getCookie(name) {
            const value = `; ${document.cookie}`;
            const parts = value.split(`; ${name}=`);
            if (parts.length === 2) return parts.pop().split(';').shift();
        }
        // 设置Cookie
        function setCookie(name, value, days = 365) {
            const expires = new Date();
            expires.setTime(expires.getTime() + days * 24 * 60 * 60 * 1000);
            document.cookie = `${name}=${value};expires=${expires.toUTCString()};path=/`;
        }
        // 删除所有Cookie
        function deleteAllCookies() {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i];
                const eqPos = cookie.indexOf('=');
                const name = eqPos > -1 ? cookie.substr(0, eqPos) : cookie;
                document.cookie = name + '=;expires=Thu, 01 Jan 1970 00:00:00 GMT;path=/';
            }
        }
        // 设备选择器事件处理
        function handleDeviceChange(device) {
            setCookie(deviceCookieName, device);
            // 保存当前表单数据
            saveFormData();
            // 恢复表单数据（切换设备后保持内容不消失）
            restoreFormData();
        }
        // 桌面端设备选择器
        document.getElementById('deviceSelect').addEventListener('change', function() {
            handleDeviceChange(this.value);
        });
        // 移动端设备选择器
        document.getElementById('deviceSelectMobile').addEventListener('change', function() {
            handleDeviceChange(this.value);
            // 关闭移动菜单
            document.getElementById('menuToggle').classList.remove('active');
            document.getElementById('mobileMenu').classList.remove('visible');
            document.body.style.overflow = '';
        });
        // 初始化设备选择器
        function initDeviceSelector() {
            const currentDevice = getCurrentDevice();
            document.getElementById('deviceSelect').value = currentDevice;
            document.getElementById('deviceSelectMobile').value = currentDevice;
        }
        // 保存表单数据到Cookie
        function saveFormData() {
            const formFields = ['title', 'body', 'level', 'sound', 'volume', 'icon', 'group', 'url', 'action', 'call', 'isArchive', 'id', 'delete'];
            const formData = {};
            formFields.forEach(field => {
                const element = document.getElementById(field);
                if (element) {
                    formData[field] = element.value;
                }
            });
            setCookie(formDataCookieName, JSON.stringify(formData));
        }
        // 从Cookie恢复表单数据
        function restoreFormData() {
            const cookieValue = getCookie(formDataCookieName);
            if (cookieValue) {
                try {
                    const formData = JSON.parse(cookieValue);
                    Object.keys(formData).forEach(field => {
                        const element = document.getElementById(field);
                        if (element) {
                            element.value = formData[field];
                        }
                    });
                } catch (e) {
                    console.error('恢复表单数据失败:', e);
                }
            }
        }
        // 表单字段输入时保存
        function setupFormAutoSave() {
            const form = document.getElementById('barkForm');
            const formFields = form.querySelectorAll('input, select, textarea');
            formFields.forEach(field => {
                field.addEventListener('input', saveFormData);
                field.addEventListener('change', saveFormData);
            });
        }
        // 重置按钮功能
        document.getElementById('resetBtn').addEventListener('click', function() {
            const form = document.getElementById('barkForm');
            form.reset();
            // 重置后清除Cookie保存的表单数据
            setCookie(formDataCookieName, JSON.stringify({}));
            showStatusMessage('表单已重置');
        });
        // 删除Cookie按钮
        document.getElementById('deleteCookieBtn').addEventListener('click', function() {
            deleteAllCookies();
            // 重新加载页面以清除所有状态
            location.reload();
        });
        // 从Cookie加载历史记录
        function loadHistoryFromCookie() {
            const cookieValue = getCookie(historyCookieName);
            if (cookieValue) {
                try {
                    return JSON.parse(decodeURIComponent(cookieValue)) || [];
                } catch (e) {
                    console.error('解析历史记录Cookie失败:', e);
                    return [];
                }
            }
            return [];
        }
        // 保存历史记录到Cookie
        function saveHistoryToCookie(history) {
            // 限制历史记录数量
            if (history.length > maxHistoryItems) {
                history = history.slice(-maxHistoryItems);
            }
            const serializedHistory = JSON.stringify(history);
            setCookie(historyCookieName, encodeURIComponent(serializedHistory));
        }
        // 添加发送记录到历史
        function addHistoryEntry(entry) {
            const history = loadHistoryFromCookie();
            history.push(entry);
            saveHistoryToCookie(history);
            renderHistoryList(history);
        }
        // 删除历史记录
        function deleteHistoryItem(index) {
            const history = loadHistoryFromCookie();
            history.splice(index, 1);
            saveHistoryToCookie(history);
            renderHistoryList(history);
        }
        // 渲染历史列表
        function renderHistoryList(history) {
            const historyListElement = document.getElementById('historyList');
            historyListElement.innerHTML = ''; // 清空现有内容
            if (history.length === 0) {
                historyListElement.innerHTML = '<p>暂无历史记录</p>';
                return;
            }
            // 反向遍历，最新的在最前面
            for (let i = history.length - 1; i >= 0; i--) {
                const item = history[i];
                const historyItemElement = document.createElement('div');
                historyItemElement.className = 'history-item';
                historyItemElement.dataset.index = i;
                const timeElement = document.createElement('div');
                timeElement.className = 'time';
                timeElement.textContent = item.timestamp;
                const detailsElement = document.createElement('div');
                detailsElement.className = 'details';
                detailsElement.innerHTML = `
                    <strong>标题:</strong> ${item.title || '(无)'}<br>
                    <strong>内容:</strong> ${item.body || '(无)'}<br>
                    <strong>类型:</strong> ${item.level || 'active'}<br>
                    <strong>分组:</strong> ${item.group || '(无)'}<br>
                    <strong>ID:</strong> ${item.id || '(无)'}<br>
                    <strong>删除:</strong> ${item.delete || '(否)'}<br>
                    <strong>保存:</strong> ${item.isArchive || '(默认)'}
                `;
                // 添加删除按钮
                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'delete-btn';
                deleteBtn.textContent = '删除';
                deleteBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const index = parseInt(historyItemElement.dataset.index);
                    deleteHistoryItem(index);
                });
                // 添加左滑触摸事件
                let touchStartX = 0;
                let touchEndX = 0;
                historyItemElement.addEventListener('touchstart', function(e) {
                    touchStartX = e.changedTouches[0].screenX;
                }, { passive: true });
                historyItemElement.addEventListener('touchend', function(e) {
                    touchEndX = e.changedTouches[0].screenX;
                    handleSwipe();
                }, { passive: true });
                function handleSwipe() {
                    const swipeThreshold = 50;
                    if (touchEndX < touchStartX - swipeThreshold) {
                        // 左滑
                        historyItemElement.classList.add('swiped');
                    } else if (touchEndX > touchStartX + swipeThreshold) {
                        // 右滑
                        historyItemElement.classList.remove('swiped');
                    }
                }
                // 点击其他地方关闭滑块
                document.addEventListener('click', function(e) {
                    if (!historyItemElement.contains(e.target)) {
                        historyItemElement.classList.remove('swiped');
                    }
                });
                historyItemElement.appendChild(timeElement);
                historyItemElement.appendChild(detailsElement);
                historyItemElement.appendChild(deleteBtn);
                historyListElement.appendChild(historyItemElement);
            }
        }
        // 显示状态消息
        function showStatusMessage(message, isSuccess = true) {
            const statusElement = document.getElementById('statusMessage');
            statusElement.textContent = message;
            statusElement.className = `status-message ${isSuccess ? 'status-success' : 'status-error'}`;
            statusElement.style.display = 'block';
            // 3秒后自动隐藏
            setTimeout(() => {
                statusElement.style.display = 'none';
            }, 3000);
        }
        // 表单提交事件处理
        document.getElementById('barkForm').addEventListener('submit', async (e) => {
            e.preventDefault(); // 阻止默认表单提交
            // 获取表单数据
            const formData = new FormData(e.target);
            const payload = {};
            const keysToProcess = ['title', 'body', 'level', 'sound', 'volume', 'icon', 'group', 'url', 'action', 'call', 'isArchive', 'id', 'delete'];
            keysToProcess.forEach(key => {
                const value = formData.get(key);
                if (value !== '') { // 只有当值不为空字符串时才添加到payload
                    payload[key] = value;
                }
            });
            // 检查是否为删除操作，如果是，则必须有ID
            if (payload.delete === '1' && !payload.id) {
                showStatusMessage('错误: 删除通知需要提供ID。', false);
                return;
            }
            try {
                const currentApiUrl = getCurrentApiUrl();
                const response = await fetch(currentApiUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(payload)
                });
                if (response.ok) {
                    showStatusMessage('通知发送成功！');
                    // 添加到历史记录
                    const now = new Date().toLocaleString();
                    const historyEntry = {
                        timestamp: now,
                        title: payload.title,
                        body: payload.body,
                        level: payload.level,
                        group: payload.group,
                        id: payload.id,
                        delete: payload.delete,
                        isArchive: payload.isArchive // 记录isArchive值
                    };
                    addHistoryEntry(historyEntry);
                    // 清空表单 (delete 和 id 保留，方便删除操作)
                    // 保存表单数据到Cookie
                    saveFormData();
                } else {
                    throw new Error(`API响应错误: ${response.status} ${response.statusText}`);
                }
            } catch (error) {
                console.error('发送请求失败:', error);
                showStatusMessage(`发送失败: ${error.message}`, false);
            }
        });
        // 页面加载时渲染历史记录
        document.addEventListener('DOMContentLoaded', () => {
            // 初始化设备选择器
            initDeviceSelector();
            // 恢复表单数据（从Cookie）
            restoreFormData();
            // 设置表单自动保存
            setupFormAutoSave();
            // 渲染历史记录
            const history = loadHistoryFromCookie();
            renderHistoryList(history);
            // 滚动动画和进度条逻辑 (复用模板)
            const elements = document.querySelectorAll('.title-container, .card');
            const backToTopButton = document.getElementById('backToTop');
            const progressBar = document.getElementById('progress');
            checkVisibility();
            let scrollTimeout;
            window.addEventListener('scroll', () => {
                if (scrollTimeout) {
                    cancelAnimationFrame(scrollTimeout);
                }
                scrollTimeout = requestAnimationFrame(() => {
                    checkVisibility();
                    toggleBackToTopButton();
                    updateProgressBar();
                });
            });
            backToTopButton.addEventListener('click', () => {
                window.scrollTo({
                    top: 0,
                    behavior: 'smooth'
                });
            });
            function checkVisibility() {
                const windowHeight = window.innerHeight || document.documentElement.clientHeight;
                elements.forEach(element => {
                    if (element.classList.contains('visible')) return;
                    const rect = element.getBoundingClientRect();
                    if (rect.top <= windowHeight - 100) {
                        // 使用非线性延迟，使元素级联显示更自然
                        const index = Array.from(elements).indexOf(element);
                        const delay = Math.pow(index, 1.1) * 100;
                        setTimeout(() => {
                            element.classList.add('visible');
                        }, delay);
                    }
                });
            }
            function toggleBackToTopButton() {
                if (window.scrollY > 300) {
                    backToTopButton.classList.add('visible');
                } else {
                    backToTopButton.classList.remove('visible');
                }
            }
            function updateProgressBar() {
                const totalHeight = document.body.scrollHeight - window.innerHeight;
                const progress = (window.scrollY / totalHeight) * 100;
                progressBar.style.width = progress + '%';
            }
        });
    </script>
</body>
</html>